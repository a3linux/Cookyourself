{% extends "base.html" %}
{% load static from staticfiles %}
{% block title %}
  <title>dish page</title>
{% endblock %}
{% block individual_css %}
  <link href="{% static 'cookyourself/css/dish.css' %}" rel="stylesheet">
{% endblock %}
{% block individual_js %}
  <script type="text/javascript" async="" src="https://api.flattr.com/js/0.6/load.js?mode=auto"></script>
  <script src="//www.tools4noobs.com/js/main-combined.js"></script>
  <script src="{% static 'cookyourself/js/video.js' %}" type="text/javascript"></script>
  <script src="{% static 'cookyourself/js/dish.js' %}" type="text/javascript"></script>
{% endblock %}
{%if dish%}
{% block main_body %}

<script>
  // This is called with the results from from FB.getLoginStatus().
  function statusChangeCallback(response) {
    console.log('statusChangeCallback');
    console.log(response);
    // The response object is returned with a status field that lets the
    // app know the current login status of the person.
    // Full docs on the response object can be found in the documentation
    // for FB.getLoginStatus().
    if (response.status === 'connected') {
      // Logged into your app and Facebook.
      testAPI();
    } else if (response.status === 'not_authorized') {
      // The person is logged into Facebook, but not your app.
      document.getElementById('status').innerHTML = 'Please log ' +
        'into this app.';
    } else {
      // The person is not logged into Facebook, so we're not sure if
      // they are logged into this app or not.
      document.getElementById('status').innerHTML = 'Please log ' +
        'into Facebook.';
    }
  }

  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.
  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }

  window.fbAsyncInit = function() {
  FB.init({
    appId      : '945239262274790',
    cookie     : true,  // enable cookies to allow the server to access 
                        // the session
    xfbml      : true,  // parse social plugins on this page
    version    : 'v2.8' // use graph api version 2.8
  });

  // Now that we've initialized the JavaScript SDK, we call 
  // FB.getLoginStatus().  This function gets the state of the
  // person visiting this page and can return one of three states to
  // the callback you provide.  They can be:
  //
  // 1. Logged into your app ('connected')
  // 2. Logged into Facebook, but not your app ('not_authorized')
  // 3. Not logged into Facebook and can't tell if they are logged into
  //    your app or not.
  //
  // These three cases are handled in the callback function.

  FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });

  };

  // Load the SDK asynchronously
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));

  // Here we run a very simple test of the Graph API after login is
  // successful.  See statusChangeCallback() for when this call is made.
  function testAPI() {
    console.log('Welcome!  Fetching your information.... ');
    FB.api('/me', function(response) {
      console.log('Successful login for: ' + response.name);
      document.getElementById('status').innerHTML =
        'Thanks for logging in, ' + response.name + '!';
    });
  }
</script>
  <div class="container-fluid">
    <ol class="breadcrumb">
      <li><a href="#">Home</a></li>
      <li><a href="#">Recipes</a></li>
      <li><a href="#">World Cuisine</a></li>
      <li><a href="#">American</a></li>
      <li class="active">chicken</li>
    </ol>
  </div>
  
  <div class="container" id="jcont">
    <div class="jumbotron" id="btop">
      <div class="row">
        <div
            class="col-xs-12 col-sm-12 col-md-12 col-lg-8 col-lg-offset-0 text-center">
          <img class="dish-pic" alt="dish1"
               src={{image}}>
        </div>
        <div
            class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-4 col-lg-offset-0 text-center dish-info">
          <p> {{dish.name}} </p>
          <h4>
            <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
            <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
            <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
            <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
            <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
          </h4>
          <h5><a href="#">I made it</a> | <a href="#">2 reviews</a></h5>
          <h5> Recipe by: <a href="#">{{dish.author}}</a></h5>
          <h5> Created on: {{dish.created_on}} </h5>
          <h5> Style: {{dish.style}} </h5>
          <h5> Calories: {{dish.calories}} </h5>
          <h5> Price: {{dish.price}} </h5>
          <br>
          <h5 class="description">"{{dish.description}}"
          </h5>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid" id="below">
    <div class="navbar navbar-default" id="nav">
      <div class="navbar-header">
        <button type="button" id="bheart" class="navbar-toggle collapsed" data-toggle="collapse"
                data-target="#likeNavbar" aria-expanded="false" aria-controls="navbar">
          <span class="glyphicon glyphicon-heart" id="star"></span>
        </button>
        <p class="navbar-brand">Like it?</p>
      </div>
      <div id="likeNavbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="#">
            <span class="glyphicon glyphicon-heart"></span>
            <span class="nav-item">Save</span>
          </a></li>
          <li><a href="#">
            <span class="glyphicon glyphicon-ok"></span>
            <span class="nav-item">I Made It</span>
          </a></li>
          <li><a href="#">
            <span class="glyphicon glyphicon-new-window"></span>
            <span class="nav-item">Share</span>
          </a></li>
          <li><a href="#">
            <span class="glyphicon glyphicon-print"></span>
            <span class="nav-item">Print</span>
          </a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>



  <div class="container" id="ingredient">
    <div class="row">
      <h3> Ingredients</h3>
      <hr>
      <div class=col-lg-8 id="ingre-list">
        <ul>
          {% for iset in isets %}
          <div><a class="glyphicon glyphicon-check" id={{iset.ingredient.id}}></a>
               <span class="text">{{iset.amount|floatformat}} {%if iset.unit %}{{iset.unit}}{% endif %}  {{iset.ingredient.name}} </span>
          </div>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <div class="container" id="instruction">
    <h3> Instructions </h3>
    <hr>
    {% if tutorial.video %}
    <div class="row">
    
      <div id="video" class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
        <div class="video-container">
          <div id="player" data-video={{tutorial.video}}></div>
        </div>
      </div>
    </div>
    {% endif %}
    <div class="row">
    <!--This div is to show how to transfer video url to video.js -->
      <div id="video" class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
        <div class="video-container">
          <div id="player" data-video="Fu2PVtbwfhc"></div>
        </div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-lg-8">
        <ol>
        {% for instruction in instructions %}
          <li><p class="text">{{instruction.content}}</p></li>
        {% endfor %}
        </ol>
      </div>
    </div>
  </div>

  <div class="container">
    <h3> Comments </h3>
    <hr>
    <section id="comments_section" class="jumbotron">
      <div class="row">
        <div class="col-xs-12 col-md-5 col-lg-4">
            <textarea name="item" style="resize: none" rows="2" cols="50%"
                      placeholder="Any comments?"></textarea>
        </div>
        <div class="col-xs-12 col-xs-offset-0 col-md-5 col-md-offset-2 col-lg-4 col-lg-offset-2">
          <input class="btn btn-warning" type="submit" value="Post">
        </div>
      </div>
      {% for post in posts%}
      <div class="media">
        <div class="media-left">
          <a href="#">
            <img class="media-object" src="{{post.author.photo.url}}"
                 class="img-rounded"
                 alt="" height="50px">
          </a>
        </div>
        <div class="media-body">
          <h4><a href="">{{post.author.user.username}}</a></h4>
          <small><span class="glyphicon glyphicon-time"></span>&nbsp;{{post.created_on}}</small>
        </div>

        <h5>
          {{post.content}}
        </h5>
      </div> 
      {% endfor %}
      </section>
  </div>
  <div class="container">
  <fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
  </fb:login-button>
  </div>

<div id="status">
</div>

  {% endblock %}
{% endif %}


